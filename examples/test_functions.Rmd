---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(MASS)
library(data.table)
library(ggplot2)
source("predictor.R")
source("interpret.R")
data <- MASS::crabs
set.seed(491)
test_ind <- sample(1:nrow(data), nrow(data)%/%5)
train_reg <- data[-test_ind,]
test_reg <- data[test_ind,]
```

```{r}
# try with different dataset
set.seed(491)
test_ind <- sample(1:nrow(data), nrow(data)%/%5)
train_reg <- data[-test_ind,]
test_reg <- data[test_ind,]

forest <- forestry(x=train_reg[,-which(names(train_reg)=="CW")],
                   y=train_reg[,which(names(train_reg)=="CW")])
forest_predictor <- Predictor$new(model = forest, data=train_reg, y="CW",
                                  task = "regression")


forestinterpret <- Interpreter$new(predictor = forest_predictor)


# Methods
forestinterpret.2 <- set.data.points(forestinterpret, as.integer(1:10))
forestinterpret.2

# Check to see that the specified functions are behaving
print(forestinterpret.2$functions.1d$FL(1))

data <- train_reg[1:10,]
data$FL <- 1
mean(predict(forest, data[,-which(names(train_reg)=="CW")]))

# check plotter wrapper
forestplot <- Plotter$new(forestinterpret, features = c("FL", "RW", "CL", "BD"),
                          features.2d = data.frame(col1 = c("RW", "CL", "BD"),
                                                   col2 = c("sp", "sex", "FL")))
forestplot$center.at$FL
forestplot$grid.points$FL
plots <- plot.Plotter(forestplot)


# test functions
set.center.at(forestplot, "FL", 2) # for numeric
forestplot$center.at$indus
set.grid.points(forestplot, "FL", c(1.2,3.9,1.3, 1.4))
forestplot$grid.points$indus


```


```{r}
# 2 variable pdp functions
data <- train_reg[1:10,]
data$FL <- 0.5
data$RW <- 3.9
mean(predict(forest, data[,-which(names(train_reg)=="CW")]))

forestinterpret.2$functions.2d[["FL"]][["RW"]](0.5, 3.9)
```

