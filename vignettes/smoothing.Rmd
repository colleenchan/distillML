---
title: "Smoothing PDP + ALE Curves"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Smoothing PDP + ALE Curves}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


## Advanced Feature: Curve Smoothing

To get smoothed plots of PDP, ICE, or ALE curves for continuous features, we also 
have options to smooth the curves using the `stats:ksmooth` package. This may be 
beneficial for users who want well-behaved curves for plotting and distillation. To 
do so, we set parameter `smooth` equal to `TRUE` when calling the plot function, and 
can set the bin size, number of points to interpolate, and the type of smoothing with 
the parameters `smooth.binsize`, `smooth.npoints`, and `smooth.type` respectively. These 
parameters correspond to 

```{r}
library(MASS)
library(distillML)
library(Rforestry)

# Load in data 
data("iris")
set.seed(491)
data <- iris

# Train a random forest on the data set
forest <- forestry(x=data[,-1],
                   y=data[,1])

# Create a predictor wrapper for the forest
forest_predictor <- Predictor$new(model = forest,
                                  data=data,
                                  y="Sepal.Length",
                                  task = "regression")

# We specify grid.size for clarity (grid.size = 50 by default)
forest_interpreter <- Interpreter$new(forest_predictor,
                                      grid.size = 50)
print(forest_interpreter)
```

Lets examine some of these in action.

```{r}
# Default smoothing options
plot(forest_interpreter,
     features = c("Sepal.Width"),
     smooth = T)

# compare to unsmoothed plots
plot(forest_interpreter, 
     features = c("Sepal.Width"))

# With Additional Parameters
plot(forest_interpreter,
     features = c("Sepal.Width"),
     smooth = T,
     method = "ale",
     smooth.binsize = 2,
     smooth.type = "box",
     smooth.npoints = 500)
```

For the bin size, the default is the maximum difference in the grid points for 
the given feature. The type of smoothing done is by default uses a Gaussian kernel, and 
the number of points is double the number of grid points. When setting the 
bin size and number of points, one should be careful about creating empty 
kernels. These result in NA values and prompt the user to put different values 
for these parameters.

For computing the kernel smoothing, we use the ksmooth function.

For further details on these methods, please refer to the "References" tab, which 
contains documentation for each of the methods discussed.


