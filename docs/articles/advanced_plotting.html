<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Distillery">
<title>Plotting Methods • Distillery</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plotting Methods">
<meta property="og:description" content="Distillery">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Distillery</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.16</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_plotting.html">Plotting Methods</a>
    <a class="dropdown-item" href="../articles/local_surrogates.html">Local Surrogate</a>
    <a class="dropdown-item" href="../articles/model_distillation.html">Distillation Methods</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/forestry-labs/interpretability_sandbox/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Plotting Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/forestry-labs/interpretability_sandbox/blob/HEAD/vignettes/advanced_plotting.Rmd" class="external-link"><code>vignettes/advanced_plotting.Rmd</code></a></small>
      <div class="d-none name"><code>advanced_plotting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="plotting-methods">Plotting Methods<a class="anchor" aria-label="anchor" href="#plotting-methods"></a>
</h2>
<p>In this article, we provide more detail on the different plots for the interpretability methods, including how to set the number of points plotted for a given feature, setting the center of the plots, and additional options not discussed in the general overview.</p>
<div class="section level3">
<h3 id="interpreter-class-initialization">Interpreter Class Initialization<a class="anchor" aria-label="anchor" href="#interpreter-class-initialization"></a>
</h3>
<p>For the examples in the additional articles, we use the well-known <code>iris</code> dataset, which provides information on 50 flowers from each of 3 species of iris, and a random forest model for predicting the <code>"Sepal.Length"</code> variable. To begin making interpretability plots, we must start with an <code>Interpreter</code> object, which consists of the following parameters:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/forestry-labs/interpretability_sandbox" class="external-link">Distillery</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/forestry-labs/Rforestry" class="external-link">Rforestry</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## ## </span>
<span class="co">## ##  Rforestry (Version 0.9.0.98, Build Date: R 4.1.1; x86_64-apple-darwin17.0; 2022-04-11 19:41:15 UTC; unix)</span>
<span class="co">## ##  See https://github.com/forestry-labs for additional documentation.</span>
<span class="co">## ##  Please cite software as:</span>
<span class="co">## ##    Soren R. Kunzel, Theo F. Saarinen, Edward W. Liu, Jasjeet S. Sekhon. 2019.</span>
<span class="co">## ##    ''Linear Aggregation in Tree-based Estimators.'' arXiv preprint </span>
<span class="co">## ##    arXiv:1906.06463. https://arxiv.org/abs/1906.06463 </span>
<span class="co">## ##</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load in data </span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">491</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">iris</span>

<span class="co"># Train a random forest on the data set</span>
<span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rforestry/man/forestry.html" class="external-link">forestry</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
                   y<span class="op">=</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Create a predictor wrapper for the forest</span>
<span class="va">forest_predictor</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Predictor.html">Predictor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>model <span class="op">=</span> <span class="va">forest</span>,
                                  data<span class="op">=</span><span class="va">data</span>,
                                  y<span class="op">=</span><span class="st">"Sepal.Length"</span>,
                                  task <span class="op">=</span> <span class="st">"regression"</span><span class="op">)</span>

<span class="co"># We specify grid.size for clarity (grid.size = 50 by default)</span>
<span class="va">forest_interpreter</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Interpreter.html">Interpreter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">forest_predictor</span>,
                                      grid.size <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">forest_interpreter</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## &lt;Interpreter&gt;</span>
<span class="co">##   Public:</span>
<span class="co">##     ale.grid: list</span>
<span class="co">##     center.at: list</span>
<span class="co">##     clone: function (deep = FALSE) </span>
<span class="co">##     data.points: 67 92 60 69 104 12 24 106 112 18 2 141 64 78 83 10 6 85  ...</span>
<span class="co">##     feat.class: numeric numeric numeric factor</span>
<span class="co">##     features: Sepal.Width Petal.Length Petal.Width Species</span>
<span class="co">##     features.2d: data.frame</span>
<span class="co">##     grid.points: list</span>
<span class="co">##     grid.size: 50</span>
<span class="co">##     initialize: function (predictor = NULL, samples = 1000, data.points = NULL, </span>
<span class="co">##     pdp.1d: list</span>
<span class="co">##     pdp.2d: list</span>
<span class="co">##     predictor: Predictor, R6</span>
<span class="co">##     saved: list</span></code></pre>
<p>The following parameters in the <code>Interpreter</code> object determine different aspects of the interpretability plots:</p>
<ul>
<li>
<code>grid.size</code>: This provides the number of grid points we want for continuous features for PDP, ICE, and ALE methods. A larger input for <code>grid.size</code> creates more points that are plotted, which increases the fidelity of the plot and the computation time. This is specified when the <code>Interpreter</code> object is declared.</li>
<li>
<code>grid.points</code>: This stores lists of grid points for each feature in the data. For continuous features, the grid points are equally spaced values from the minimum value to maximum value of the feature, with the length specified by <code>grid.size</code>. This parameter determines which points to plot PDP and ICE methods.</li>
<li>
<code>center.at</code>: This stores a list of values to center the continuous features plotted for PDP and ICE curves. The center is defined as the value for a feature that we want to center at, rather than a particular value for the PDP or ICE curve. By default, this is set to the minimum value in the <code>grid.points</code> list for each continuous feature.</li>
</ul>
<p>Below, we demonstrate examples of these parameters for feature <code>Sepal.Width</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The values of Sepal.Width to be plotted by PDP and ICE curves</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">forest_interpreter</span><span class="op">$</span><span class="va">grid.points</span><span class="op">$</span><span class="va">Sepal.Width</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] 2.000000 2.048980 2.097959 2.146939 2.195918 2.244898 2.293878 2.342857</span>
<span class="co">##  [9] 2.391837 2.440816 2.489796 2.538776 2.587755 2.636735 2.685714 2.734694</span>
<span class="co">## [17] 2.783673 2.832653 2.881633 2.930612 2.979592 3.028571 3.077551 3.126531</span>
<span class="co">## [25] 3.175510 3.224490 3.273469 3.322449 3.371429 3.420408 3.469388 3.518367</span>
<span class="co">## [33] 3.567347 3.616327 3.665306 3.714286 3.763265 3.812245 3.861224 3.910204</span>
<span class="co">## [41] 3.959184 4.008163 4.057143 4.106122 4.155102 4.204082 4.253061 4.302041</span>
<span class="co">## [49] 4.351020 4.400000</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The number of grid.points is equal to the grid.size</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">forest_interpreter</span><span class="op">$</span><span class="va">grid.points</span><span class="op">$</span><span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 50</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">forest_interpreter</span><span class="op">$</span><span class="va">grid.size</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 50</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The value of Sepal.Width we center the PDP and ICE curves</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">forest_interpreter</span><span class="op">$</span><span class="va">center.at</span><span class="op">$</span><span class="va">Sepal.Width</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 2</span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot the PDP and ICE curves</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>, features <span class="op">=</span> <span class="st">"Sepal.Width"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="advanced_plotting_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>After initializing the <code>Interpreter</code>, we can still change the centers and grid points of the plot. For example, we provide some code below to provide a new set of grid points and center at the mean value for <code>Sepal.Width</code>. Note that when we set a new center value, it must be within the range of the grid points.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set new grid points</span>
<span class="fu"><a href="../reference/set.grid.points.html">set.grid.points</a></span><span class="op">(</span><span class="va">forest_interpreter</span>, <span class="st">"Sepal.Width"</span>, 
                values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4.5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Set new center</span>
<span class="fu"><a href="../reference/set.center.at.html">set.center.at</a></span><span class="op">(</span><span class="va">forest_interpreter</span>, <span class="st">"Sepal.Width"</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4.5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># New plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>, features <span class="op">=</span> <span class="st">"Sepal.Width"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="advanced_plotting_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>In contrast to the fixed grid points for PDP and ICE methods, the ALE method sets its grid points based on quantiles of the marginal distribution. By doing so, it avoids sparsity within any one neighborhood. The ALE is also always mean-centered. As a result, methods such as <code>set.grid.points</code> and <code>set.center.at</code> do not affect the ALE plots. The key parameter for the ALE method is <code>grid.size</code>, which determines the number of points calculated by the ALE.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ALE plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>, features <span class="op">=</span> <span class="st">"Sepal.Width"</span>, method <span class="op">=</span> <span class="st">"ale"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="advanced_plotting_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="additional-features-for-ice-methods-clustering">Additional Features for ICE Methods: Clustering<a class="anchor" aria-label="anchor" href="#additional-features-for-ice-methods-clustering"></a>
</h3>
<p>This package also provides a new feature to cluster the ICE curves. The default option of <code>plot</code> for the <code>Interpreter</code> class plots the ICE curves and their mean, the <code>PDP</code> curve. We introduce the use of the <code>kmeans</code> unsupervised learning algorithm as a way to better visualize groups of ICE curves. To do so, we set <code>method = "ice"</code> in the <code>plot</code> function, and can set the number of clusters and the type of clustering with the <code>clusters</code> and <code>clusterType</code> arguments respectively.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Clustering Based on the Predicted Values of the ICE Curves</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>,
     features <span class="op">=</span> <span class="st">"Sepal.Width"</span>,
     method <span class="op">=</span> <span class="st">"ice"</span>,
     clusters <span class="op">=</span> <span class="fl">4</span>,
     clusterType <span class="op">=</span> <span class="st">"preds"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="advanced_plotting_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Clustering Based on the Change in Predicted Values of the ICE Curves</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>,
     features <span class="op">=</span> <span class="st">"Sepal.Width"</span>,
     method <span class="op">=</span> <span class="st">"ice"</span>,
     clusters <span class="op">=</span> <span class="fl">4</span>,
     clusterType <span class="op">=</span> <span class="st">"gradient"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="advanced_plotting_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<p>The two options for <code>clusterType</code> differ as follows: * <code>preds</code>: Each predicted value for an ICE curve is treated as an entry in a vector, and the ICE curves as grouped based on these prediccted values. * <code>gradient</code>: Rather than clustering based on the predicted values, the gradient method takes the change in predicted values across consecutive grid points, and clusters based on these changes.</p>
<p>For further details on these methods, please refer to the “References” tab, which contains documentation for each of the methods discussed.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brian Cho, Theo Saarinen, Simon Walter, Jasjeet Sekhon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
