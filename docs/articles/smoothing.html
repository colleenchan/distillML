<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="distillML">
<title>Smoothing PDP + ALE Curves • distillML</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Smoothing PDP + ALE Curves">
<meta property="og:description" content="distillML">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">distillML</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_plotting.html">Plotting Methods</a>
    <a class="dropdown-item" href="../articles/local_surrogates.html">Local Surrogate</a>
    <a class="dropdown-item" href="../articles/model_distillation.html">Distillation Methods</a>
    <a class="dropdown-item" href="../articles/smoothing.html">Smoothing PDP + ALE Curves</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/forestry-labs/distillML/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Smoothing PDP + ALE Curves</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/forestry-labs/distillML/blob/HEAD/vignettes/smoothing.Rmd" class="external-link"><code>vignettes/smoothing.Rmd</code></a></small>
      <div class="d-none name"><code>smoothing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The partial dependence function is defined as the expectation of the
regression function predictions as the value of a single feature is
marginally perturbed. For a feature <span class="math inline">\(S\)</span> and regression function <span class="math inline">\(f\)</span>, we can write this as:</p>
<p><span class="math display">\[
PDP_S(x) := \mathbb{E}_{X}\left[f(X) \mid X_S = x\right]
\]</span> In practice we estimate the partial dependence function at a
point <span class="math inline">\(x\)</span> by taking a sample average
over the predictions of the regression function on the training data set
with the feature <span class="math inline">\(X_S\)</span> set to the
desired evaluation point <span class="math inline">\(x\)</span>.</p>
<p><span class="math display">\[
\hat{PDP}_{S}\left(x\right)=\frac{1}{n} \sum_{i=1}^{n} {f}\left(X_{i,X_s
= x }\right)
\]</span> Where <span class="math inline">\(X_{i,X_s = x }\)</span> is
the <span class="math inline">\(i\)</span>th training observation with
feature <span class="math inline">\(S\)</span> set to equal <span class="math inline">\(x\)</span>. If the training samples are drawn from
an i.i.d. sample from the true distribution of <span class="math inline">\(X\)</span>, that we take expectation with respect
to in the definition of the PDP, then the above estimate is unbiased for
the true value of the PDP function of <span class="math inline">\(f\)</span> for the <span class="math inline">\(S\)</span>th feature evaluated at <span class="math inline">\(x\)</span>. Combining these estimates at many grid
points, we can then plot the estimated PDP function as a function of
<span class="math inline">\(x\)</span>.</p>
<p>Sometimes it may be beneficial to introduce some bias into the point
wise estimates of the PDP function in order to improve the
interpretability and stability of the entire PDP function. One option is
to use kernel smoothing to smooth the estimated PDP function values.
Given independent features <span class="math inline">\(x\)</span>, and
outcomes <span class="math inline">\(y\)</span>, a kernel function <span class="math inline">\(K\)</span> and a bandwidth <span class="math inline">\(h\)</span>, the Nadaraya–Watson kernel regression
estimator is given by:</p>
<p><span class="math display">\[
\widehat{m}_{h}(x)=\frac{\sum_{i}^{n} K_{h}\left(x-x_{i}\right)
y_{i}}{\sum_{i=1}^{n} K_{h}\left(x-x_{i}\right)}
\]</span> Once we have estimated the point wise values of the PDP
function, we can apply this kernel regression to smooth the estimated
function. The predictions of the smoothed PDP function are then given
by: <span class="math display">\[
\hat{PDP}_{S, smooth}\left(x\right) =\frac{\sum_{i \in X_{train}}
K_{h}\left(x-x_{i}\right) \hat{PDP}_{S}\left(x_i\right) }{\sum_{i \in
X_{train}} K_{h}\left(x-x_{i}\right)}
\]</span> We implement this method and allow the user to specify the
desired kernel, <span class="math inline">\(K\)</span>, and bandwidth
<span class="math inline">\(h\)</span>.</p>
</div>
<div class="section level2">
<h2 id="curve-smoothing">Curve Smoothing<a class="anchor" aria-label="anchor" href="#curve-smoothing"></a>
</h2>
<p>To get smoothed plots of PDP, ICE, or ALE curves for continuous
features, we also have options to smooth the curves using the
<code>stats:ksmooth</code> package. This may be beneficial for users who
want well-behaved curves for plotting and distillation. To do so, we set
parameter <code>smooth</code> equal to <code>TRUE</code> when calling
the plot function, and can set the bandwidth, number of points to
interpolate, and the type of smoothing with the parameters
<code>smooth.binsize</code>, <code>smooth.npoints</code>, and
<code>smooth.type</code> respectively.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/forestry-labs/distillML" class="external-link">distillML</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/forestry-labs/Rforestry" class="external-link">Rforestry</a></span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: package 'Rforestry' was built under R version 4.1.2</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load in data </span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">491</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">iris</span>

<span class="co"># Train a random forest on the data set</span>
<span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rforestry/man/forestry.html" class="external-link">forestry</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
                   y<span class="op">=</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>

<span class="co"># Create a predictor wrapper for the forest</span>
<span class="va">forest_predictor</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Predictor.html">Predictor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>model <span class="op">=</span> <span class="va">forest</span>,
                                  data<span class="op">=</span><span class="va">data</span>,
                                  y<span class="op">=</span><span class="st">"Sepal.Length"</span>,
                                  task <span class="op">=</span> <span class="st">"regression"</span><span class="op">)</span>

<span class="co"># We specify grid.size for clarity (grid.size = 50 by default)</span>
<span class="va">forest_interpreter</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Interpreter.html">Interpreter</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">forest_predictor</span><span class="op">)</span></code></pre></div>
<p>We can compare the smooth and standard PDP plots for the same
model:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Default smoothing options</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>,
     method <span class="op">=</span> <span class="st">"pdp"</span>,
     features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span><span class="op">)</span>,
     smooth <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="smoothing_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># compare to unsmoothed plots</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>, 
     method <span class="op">=</span> <span class="st">"pdp"</span>,
     features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="smoothing_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<p>For the bandwidth, the default is the maximum difference in the grid
points for the given feature. The type of smoothing done is by default
uses a Gaussian kernel, and the number of points is double the number of
grid points. When setting the bandwidth and number of points, one should
be careful about creating empty kernels. These result in NA values and
prompt the user to put different values for these parameters.</p>
<p>We can also smooth ALE and ICE plots in the same way:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Smooth ICE plots</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>,
     features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span><span class="op">)</span>,
     smooth <span class="op">=</span> <span class="cn">T</span>,
     method <span class="op">=</span> <span class="st">"pdp+ice"</span>,
     smooth.binsize <span class="op">=</span> <span class="fl">.1</span>,
     smooth.npoints <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="smoothing_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Smooth ALE plots</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>,
     features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span><span class="op">)</span>,
     smooth <span class="op">=</span> <span class="cn">T</span>,
     method <span class="op">=</span> <span class="st">"ale"</span>,
     smooth.binsize <span class="op">=</span> <span class="fl">.2</span>,
     smooth.npoints <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="smoothing_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Standard ALE plots</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">forest_interpreter</span>,
     features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span><span class="op">)</span>,
     method <span class="op">=</span> <span class="st">"ale"</span>,
     smooth <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## $Sepal.Width</span></code></pre>
<p><img src="smoothing_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>For further details on these methods, please refer to the
“References” tab, which contains documentation for each of the methods
discussed.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brian Cho, Theo Saarinen, Simon Walter, Jasjeet Sekhon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
