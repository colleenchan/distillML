<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Distillery">
<title>Prediction Wrapper • Distillery</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prediction Wrapper">
<meta property="og:description" content="Distillery">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Distillery</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.16</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_plotting.html">Advanced Plotting Features</a>
    <a class="dropdown-item" href="../articles/local_surrogates.html">Local Surrogate</a>
    <a class="dropdown-item" href="../articles/model_distillation.html">Distillation Methods</a>
    <a class="dropdown-item" href="../articles/prediction_wrapper.html">Prediction Wrapper</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/forestry-labs/interpretability_sandbox/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Prediction Wrapper</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/forestry-labs/interpretability_sandbox/blob/HEAD/vignettes/prediction_wrapper.Rmd" class="external-link"><code>vignettes/prediction_wrapper.Rmd</code></a></small>
      <div class="d-none name"><code>prediction_wrapper.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="prediction-wrapper-support">Prediction Wrapper Support<a class="anchor" aria-label="anchor" href="#prediction-wrapper-support"></a>
</h2>
<p>The start of using any machine learning algorithm with the <code>Distillery</code> package is the prediction wrapper, which wraps any machine learning algorithm and converts it to a <code>Predictor</code> class object. The <code>Predictor</code> wrapper requires a single set of predictions at the end, and therefore users may need to provide their own prediction functions based on the original algorithm they hope to wrap. This page provides two key examples: predicting probabilities of being in a specific class for a categorical feature, and specifying one’s own prediction function.</p>
<div class="section level3">
<h3 id="predictor-wrapper-with-categorical-features">Predictor Wrapper With Categorical Features<a class="anchor" aria-label="anchor" href="#predictor-wrapper-with-categorical-features"></a>
</h3>
<p>To use <code>Distillery</code> with categorical feature prediction, the user specifies the prediction task as <code>task = "classification</code>, chooses a specific value of the categorical feature with the <code>class</code> argument, and provide the <code>type</code> argument for the prediction. Below, we demonstrate this with an example of using a multinomial logstic regression model to predict the likelihood of a iris observation being of the “setosa” species.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the required packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/forestry-labs/interpretability_sandbox" class="external-link">Distillery</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">nnet</a></span><span class="op">)</span>

<span class="co"># Load in data </span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"iris"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">491</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">iris</span>

<span class="co"># Train a mutinomial logistic regression model on the data set</span>
<span class="va">multilog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## # weights:  18 (10 variable)</span>
<span class="co">## initial  value 164.791843 </span>
<span class="co">## iter  10 value 16.177348</span>
<span class="co">## iter  20 value 7.111438</span>
<span class="co">## iter  30 value 6.182999</span>
<span class="co">## iter  40 value 5.984028</span>
<span class="co">## iter  50 value 5.961278</span>
<span class="co">## iter  60 value 5.954900</span>
<span class="co">## iter  70 value 5.951851</span>
<span class="co">## iter  80 value 5.950343</span>
<span class="co">## iter  90 value 5.949904</span>
<span class="co">## iter 100 value 5.949867</span>
<span class="co">## final  value 5.949867 </span>
<span class="co">## stopped after 100 iterations</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">multilog</span>, type <span class="op">=</span> <span class="st">"probs"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      setosa   versicolor    virginica</span>
<span class="co">## 1 1.0000000 1.526406e-09 2.716417e-36</span>
<span class="co">## 2 0.9999996 3.536476e-07 2.883729e-32</span>
<span class="co">## 3 1.0000000 4.443506e-08 6.103424e-34</span>
<span class="co">## 4 0.9999968 3.163905e-06 7.117010e-31</span>
<span class="co">## 5 1.0000000 1.102983e-09 1.289946e-36</span>
<span class="co">## 6 1.0000000 3.521573e-10 1.344907e-35</span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a predictor wrapper for the model (specify task, class, type)</span>
<span class="va">setosa_predictor</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Predictor.html">Predictor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>model <span class="op">=</span> <span class="va">multilog</span>,
                                  data<span class="op">=</span><span class="va">data</span>,
                                  y<span class="op">=</span><span class="st">"Species"</span>,
                                  task <span class="op">=</span> <span class="st">"classification"</span>,
                                  class <span class="op">=</span> <span class="st">"setosa"</span>,
                                  type <span class="op">=</span> <span class="st">"probs"</span><span class="op">)</span>

<span class="co"># Predictions returned for setosa probabilities</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">setosa_predictor</span>, <span class="va">iris</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      setosa</span>
<span class="co">## 1 1.0000000</span>
<span class="co">## 2 0.9999996</span>
<span class="co">## 3 1.0000000</span>
<span class="co">## 4 0.9999968</span>
<span class="co">## 5 1.0000000</span>
<span class="co">## 6 1.0000000</span></code></pre>
<p>As desired, we see that the final predictions are the predicted probabiltiies of an observation being a “setosa” type iris.</p>
</div>
<div class="section level3">
<h3 id="specifying-user-inputted-prediction-functiobs">Specifying User-Inputted Prediction Functiobs<a class="anchor" aria-label="anchor" href="#specifying-user-inputted-prediction-functiobs"></a>
</h3>
<p>More generally, to get a single vector or column of predictions, we may need to specify the prediction function itself. In this case, the user can pass their own prediction function with the <code>predict_func</code> argument when intialiizing the <code>Predictor</code> object. We provide an example of this with the BART (Bayesian Additive Regression Tree) algorithm from package <code>dbarts</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vdorie/dbarts" class="external-link">dbarts</a></span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: package 'dbarts' was built under R version 4.1.2</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cat.index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Species"</span><span class="op">)</span> <span class="co"># BART requires numerical features</span>

<span class="co"># create a BART model</span>
<span class="va">bart.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">bart</a></span><span class="op">(</span>x.train <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">cat.index</span><span class="op">)</span><span class="op">]</span>,
                   y.train <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,
                   keeptrees <span class="op">=</span> <span class="cn">T</span>,
                   ndpost <span class="op">=</span> <span class="fl">500</span>,
                   verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co"># default predictions result in multiple columns</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">bart.model</span>, <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">cat.index</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></code></pre></div>
<pre><code><span class="co">##          [,1]     [,2]     [,3]     [,4]     [,5]</span>
<span class="co">## [1,] 4.894394 4.692147 4.967452 4.681489 4.948031</span>
<span class="co">## [2,] 4.899861 4.631130 4.889335 4.832738 4.877766</span>
<span class="co">## [3,] 5.057006 4.608528 4.792110 4.889669 5.003350</span>
<span class="co">## [4,] 4.925735 4.626869 4.932923 4.967804 4.968624</span>
<span class="co">## [5,] 5.054252 4.654580 4.905698 4.927613 4.964204</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create user-specified function</span>
<span class="va">predict_bart</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span><span class="op">)</span><span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">newdata</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># initialize Predictor object for BART</span>
<span class="va">bart_predictor</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Predictor.html">Predictor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>model <span class="op">=</span> <span class="va">bart.model</span>,
                                data <span class="op">=</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="va">cat.index</span><span class="op">]</span>,
                                predict.func <span class="op">=</span> <span class="va">predict_bart</span>,
                                y <span class="op">=</span> <span class="st">"Sepal.Length"</span>,
                                task <span class="op">=</span> <span class="st">"regression"</span><span class="op">)</span>

<span class="co"># predict with the Predictor object</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">bart_predictor</span>, <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">cat.index</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></code></pre></div>
<pre><code><span class="co">## [1] 5.064045 4.702024 4.784209 4.900565 5.058141</span></code></pre>
<p>As desired, the user-specified prediction method input results in predictions of a single vector or one-column dataframe. For further details, please refer to the documentation for the <code>Predictor</code> class in the “References” section.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Brian Cho, Theo Saarinen, Simon Walter, Jasjeet Sekhon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
